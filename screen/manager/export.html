<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>นำออกข้อมูล</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="../../assets/css/sidebar.css">
    <link rel="stylesheet" href="../../assets/css/export.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .export-file-types button.selected {
            background-color: #2d5a5e;
            color: #fff;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>SIRIN MUSEUM</h2>
                <div class="role">MANAGER</div>
            </div>

            <div class="user-profile">
                <div class="profile-avatar"><i class="fas fa-user"></i></div>
                <div class="profile-name" id="profileName">คุณผู้บริหาร</div>
                <div class="profile-role" id="profileRole">ผู้บริหารพิพิธภัณฑ์</div>
                <div class="profile-time" id="sidebarLoginTime">เข้าสู่ระบบ: 19:52</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link"><i class="bi bi-bar-chart-line"></i> แดชบอร์ด</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link active"><i class="bi bi-box-arrow-up"></i> ส่งออกข้อมูล</a>
                </li>
            </ul>
            <button class="logout-btn" onclick="logout()"><i class="bi bi-box-arrow-right"></i> ออกจากระบบ</button>
        </div>


        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1>ส่งออกข้อมูล</h1>
                <p>ส่งออกข้อมูลระบบติดตามผู้เยี่ยมชมและรายงานต่างๆ</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon"><i class="bi bi-bar-chart-fill"></i></div>
                    <div class="number" id="total-tables">10</div>
                    <div class="label">ตารางข้อมูล</div>
                </div>
                <div class="stat-card">
                    <div class="icon"><i class="bi bi-download"></i></div>
                    <div class="number" id="exports-today">0</div>
                    <div class="label">ไฟล์ส่งออกวันนี้</div>
                </div>
                <div class="stat-card">
                    <div class="icon"><i class="bi bi-folder-fill"></i></div>
                    <div class="number" id="total-exports">0</div>
                    <div class="label">ไฟล์ส่งออกทั้งหมด</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('visitor-export')"><i class="bi bi-people-fill"></i>
                    ข้อมูลผู้เยี่ยมชม</button>
                <button class="tab-button" onclick="showTab('beacon-export')"><i class="bi bi-broadcast-pin"></i> ข้อมูล
                    Beacon</button>
                <button class="tab-button" onclick="showTab('system-export')"><i class="bi bi-gear-fill"></i>
                    ข้อมูลระบบ</button>
                <button class="tab-button" onclick="showTab('export-history')"><i class="bi bi-clipboard-data-fill"></i>
                    ประวัติส่งออก</button>
            </div>

            <!-- Visitor Export Tab -->
            <div id="visitor-export" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(45deg, #667eea, #764ba2);"><i
                                class="bi bi-people-fill"></i></div>
                        <div class="card-title">ส่งออกข้อมูลผู้เยี่ยมชม</div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>เลือกตารางข้อมูล:</label>
                            <select id="visitor-table" onchange="handleVisitorTableChange()">
                                <option value="visitors">ข้อมูลผู้เยี่ยมชมหลัก (visitors)</option>
                                <option value="group_members">ข้อมูลสมาชิกกลุ่ม (group_members)</option>
                                <option value="room_visit_summary">สรุปการเยี่ยมชมห้อง (room_visit_summary)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>วันที่เริ่มต้น:</label>
                            <input type="date" id="visitor-start-date">
                        </div>

                        <div class="form-group">
                            <label>วันที่สิ้นสุด:</label>
                            <input type="date" id="visitor-end-date">
                        </div>
                    </div>

                    <div class="filter-section" id="visitor-filters">
                        <div class="filter-title">ตัวกรองข้อมูล</div>
                        <div class="form-grid">
                            <div class="form-group" id="visitor-type-group">
                                <label>ประเภทผู้เยี่ยมชม:</label>
                                <select id="visitor-type-filter">
                                    <option value="">ทั้งหมด</option>
                                    <option value="individual">รายบุคคล</option>
                                    <option value="group">กลุ่ม</option>
                                </select>
                            </div>

                            <div class="form-group" id="visitor-status-group">
                                <label>สถานะ:</label>
                                <select id="visitor-status-filter">
                                    <option value="">ทั้งหมด</option>
                                    <option value="1">ยังคงอยู่</option>
                                    <option value="0">ออกแล้ว</option>
                                </select>
                            </div>

                            <div class="form-group" id="favorite-room-group">
                                <label>ห้องที่ชื่นชอบ (สำหรับสรุปการเยี่ยมชม):</label>
                                <select id="favorite-room-filter">
                                    <option value="">ทั้งหมด</option>
                                    <option value="1">ห้องที่ 1</option>
                                    <option value="2">ห้องที่ 2</option>
                                    <option value="3">ห้องที่ 3</option>
                                    <option value="4">ห้องที่ 4</option>
                                    <option value="5">ห้องที่ 5</option>
                                    <option value="6">ห้องที่ 6</option>
                                    <option value="7">ห้องที่ 7</option>
                                    <option value="8">ห้องที่ 8</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>รูปแบบไฟล์:</label>
                        <div class="export-file-types">
                            <button onclick="selectFileType('csv', this, 'visitor')">CSV</button>
                            <button onclick="selectFileType('excel', this, 'visitor')">Excel</button>
                            <button onclick="selectFileType('json', this, 'visitor')">JSON</button>
                        </div>
                    </div>

                    <button class="btn" onclick="exportData('visitor')">ส่งออกข้อมูลผู้เยี่ยมชม</button>
                </div>
            </div>

            <!-- Beacon Export Tab -->
            <div id="beacon-export" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(45deg, #28a745, #20c997);"><i
                                class="bi bi-broadcast-pin"></i></div>
                        <div class="card-title">ส่งออกข้อมูล Beacon</div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>เลือกตารางข้อมูล:</label>
                            <select id="beacon-table" onchange="handleBeaconTableChange()">
                                <option value="beacons">ข้อมูล Beacon ดิบ (beacons)</option>
                                <option value="beacon_visits">การเข้าชม Beacon (beacon_visits)</option>
                                <option value="beacon_averages">ค่าเฉลี่ย Beacon (beacon_averages)</option>
                                <option value="ibeacons_tag">แท็ก Beacon (ibeacons_tag)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>วันที่เริ่มต้น:</label>
                            <input type="date" id="beacon-start-date">
                        </div>

                        <div class="form-group">
                            <label>วันที่สิ้นสุด:</label>
                            <input type="date" id="beacon-end-date">
                        </div>
                    </div>

                    <div class="filter-section" id="beacon-filters">
                        <div class="filter-title">ตัวกรองข้อมูล</div>
                        <div class="form-grid">
                            <div class="form-group" id="beacon-uuid-group">
                                <label>UUID เฉพาะ:</label>
                                <input type="text" id="uuid-filter" placeholder="กรอก UUID ที่ต้องการ (เลือกได้)">
                            </div>

                            <div class="form-group" id="beacon-status-group">
                                <label>สถานะแท็ก:</label>
                                <select id="tag-status-filter">
                                    <option value="">ทั้งหมด</option>
                                    <option value="available">พร้อมใช้งาน</option>
                                    <option value="in_use">กำลังใช้งาน</option>
                                    <option value="offline">ออฟไลน์</option>
                                    <option value="damaged">เสียหาย</option>
                                </select>
                            </div>

                            <div class="form-group" id="beacon-rssi-group">
                                <label>ช่วง RSSI:</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="number" id="rssi-min" placeholder="ต่ำสุด" style="width: 50%;">
                                    <input type="number" id="rssi-max" placeholder="สูงสุด" style="width: 50%;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>รูปแบบไฟล์:</label>
                        <div class="export-file-types">
                            <button onclick="selectFileType('csv', this, 'beacon')">CSV</button>
                            <button onclick="selectFileType('excel', this, 'beacon')">Excel</button>
                            <button onclick="selectFileType('json', this, 'beacon')">JSON</button>
                        </div>
                    </div>

                    <button class="btn" onclick="exportData('beacon')">ส่งออกข้อมล Beacon</button>
                </div>
            </div>

            <!-- System Export Tab -->
            <div id="system-export" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(45deg, #ffc107, #fd7e14);"><i
                                class="bi bi-gear-fill"></i></div>
                        <div class="card-title">ส่งออกข้อมูลระบบ</div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>เลือกตารางข้อมูล:</label>
                            <select id="system-table" onchange="handleSystemTableChange()">
                                <option value="users">ข้อมูลผู้ใช้งานระบบ (users)</option>
                                <option value="equipment_return_log">บันทึกการคืนอุปกรณ์ (equipment_return_log)</option>
                                <option value="hosts">ข้อมูล Host (hosts)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>วันที่เริ่มต้น:</label>
                            <input type="date" id="system-start-date">
                        </div>

                        <div class="form-group">
                            <label>วันที่สิ้นสุด:</label>
                            <input type="date" id="system-end-date">
                        </div>
                    </div>

                    <div class="filter-section" id="system-filters">
                        <div class="filter-title">ตัวกรองข้อมูล</div>
                        <div class="form-grid">
                            <div class="form-group" id="system-user-role-group">
                                <label>บทบาทผู้ใช้:</label>
                                <select id="user-role-filter">
                                    <option value="">ทั้งหมด</option>
                                    <option value="admin">ผู้ดูแลระบบ</option>
                                    <option value="manager">ผู้บริหาร</option>
                                    <option value="staff">เจ้าหน้าที่</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>รูปแบบไฟล์:</label>
                        <div class="export-file-types">
                            <button onclick="selectFileType('csv', this, 'system')">CSV</button>
                            <button onclick="selectFileType('excel', this, 'system')">Excel</button>
                            <button onclick="selectFileType('json', this, 'system')">JSON</button>
                        </div>
                    </div>

                    <button class="btn" onclick="exportData('system')">ส่งออกข้อมูลระบบ</button>
                </div>
            </div>

            <!-- Export History Tab -->
            <div id="export-history" class="tab-content">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>วันที่ส่งออก</th>
                                <th>ตารางข้อมูล</th>
                                <th>ช่วงวันที่</th>
                                <th>รูปแบบ</th>
                                <th>ขนาดไฟล์</th>
                                <th>สถานะ</th>
                                <th>ดาวน์โหลด</th>
                            </tr>
                        </thead>
                        <tbody id="exportHistoryTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 20px;">กำลังโหลดประวัติการส่งออก...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../assets/js/export.js"></script>

</body>

</html>