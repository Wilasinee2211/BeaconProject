<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="../../assets/css/sidebar.css" />
  <link rel="stylesheet" href="../../assets/css/dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body>
  <!-- Connection Status Indicator -->
  <div id="connectionStatus" class="connection-status disconnected">
    <i class="bi bi-wifi-off"></i> กำลังเชื่อมต่อ...
  </div>

  <div class="dashboard-layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>SIRIN MUSEUM</h2>
        <div class="role">MANAGER</div>
      </div>

      <div class="user-profile">
        <div class="profile-avatar"><i class="fas fa-user"></i></div>
        <div class="profile-name" id="profileName">คุณผู้บริหาร</div>
        <div class="profile-role" id="profileRole">ผู้บริหารพิพิธภัณฑ์</div>
        <div class="profile-time" id="sidebarLoginTime">เข้าสู่ระบบ: 19:52</div>
      </div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link active"><i class="bi bi-bar-chart-line"></i> แดชบอร์ด</a>
        </li>
        <li class="nav-item">
          <a href="export.html" class="nav-link"><i class="bi bi-box-arrow-up"></i> ส่งออกข้อมูล</a>
        </li>
      </ul>
      <button class="logout-btn" onclick="logout()"><i class="bi bi-box-arrow-right"></i> ออกจากระบบ</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="content-header">
        <h1>แดชบอร์ด</h1>
        <p>ภาพรวมระบบติดตามผู้เยี่ยมชม</p>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-card">
          <h3 class="search-title">
            <i class="bi bi-search"></i> ค้นหาผู้เยี่ยมชม
          </h3>
          <div class="search-container">
            <div class="search-group">
              <label for="searchName">ชื่อ/ชื่อกลุ่ม</label>
              <input type="text" id="searchName" placeholder="พิมพ์ชื่อ นามสกุล หรือชื่อกลุ่ม" class="search-input">
            </div>
            <div class="search-group">
              <label for="searchTag">Tag ID</label>
              <input type="text" id="searchTag" placeholder="Tag1234, ABC123" class="search-input">
            </div>
            <div class="search-group">
              <label for="searchRoom">ห้อง</label>
              <select id="searchRoom" class="search-input">
                <option value="">ทุกห้อง</option>
                <option value="1">ห้อง 1 - ห้องเกริกไกรเจ้าฟ้านักอนุรักษ์</option>
                <option value="2">ห้อง 2 - หอวัตถุทรัพย์สิ่งล้นตน</option>
                <option value="3">ห้อง 3 - เขาหลวงทรัพยากรมากมี</option>
                <option value="4">ห้อง 4 - ศักยภาพมากล้นมีให้เห็น</option>
                <option value="5">ห้อง 5 - ทรัพยากรลุ่มน้ำปากพนัง</option>
                <option value="6">ห้อง 6 - ชายฝั่งอุดมสมบูรณ์</option>
                <option value="7">ห้อง 7 - บริบูรณ์ทรัพยากรอ่าวไทย</option>
                <option value="8">ห้อง 8 - ประโยชน์แท้แก่มหาชน</option>
              </select>
            </div>
            <div class="search-actions">
              <button class="search-btn" onclick="searchVisitors()">
                <i class="bi bi-search"></i> ค้นหา
              </button>
              <button class="clear-btn" onclick="clearSearch()">
                <i class="bi bi-x-circle"></i> ล้าง
              </button>
            </div>
          </div>

          <!-- Quick Search Tags -->
          <div class="quick-searches">
            <div class="quick-search-tags">
              <span class="quick-tag" onclick="quickSearch('group')">
                <i class="bi bi-people-fill"></i> กลุ่มทั้งหมด
              </span>
              <span class="quick-tag" onclick="quickSearch('individual')">
                <i class="bi bi-person-fill"></i> บุคคลทั่วไป
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Results Modal -->
      <div id="searchModal" class="search-modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="search-modal-content">
          <div class="search-modal-header">
            <h3 id="searchModalTitle">ผลการค้นหา</h3>
            <button class="modal-close" onclick="closeSearchModal()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="search-modal-body">
            <div class="search-results-summary">
              <span id="searchResultsCount">0 รายการ</span>
            </div>
            <div id="searchResultsContainer">
              <!-- Search results will appear here -->
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content active">
        <!-- Statistics Cards -->
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #2a8c78, #1a6b5e);">
                <i class="bi bi-people-fill"></i>
              </div>
              <div class="card-title">
                ผู้เยี่ยมชมวันนี้
                <i class="bi bi-search view-all-visitors-btn" title="ดูรายละเอียดผู้เยี่ยมชมทั้งหมด"
                  style="margin-left: 8px; cursor: pointer; color: #3498db; font-size: 0.9em; opacity: 0.8;"></i>
              </div>
            </div>
            <div class="stat-number" id="totalVisitors">-</div>
            <div class="stat-label">คน</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #3498db, #2980b9);">
                <i class="bi bi-building"></i>
              </div>
              <div class="card-title">ห้องที่เปิดใช้งาน</div>
            </div>
            <div class="stat-number">8</div>
            <div class="stat-label">ห้อง</div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-icon" style="background: linear-gradient(45deg, #9b59b6, #8e44ad);">
                <i class="bi bi-wifi"></i>
              </div>
              <div class="card-title">iBeacon ออนไลน์</div>
            </div>
            <div class="stat-number" id="activeBeacons">-</div>
            <div class="stat-label">อุปกรณ์</div>
          </div>
        </div>

        <!-- Section Divider -->
        <div class="section-divider">
          <h2><i class="bi bi-map"></i> แผนผังพิพิธภัณฑ์และสถิติแต่ละห้อง</h2>
          <p>ข้อมูลผู้เยี่ยมชมแบบเรียลไทม์และการติดตามการเคลื่อนไหว</p>
        </div>

        <!-- Museum Layout Section -->
        <div class="main-dashboard">
          <div class="museum-layout">
            <h2 class="layout-title">
              <i class="bi bi-map-fill"></i>
              แผนผังพิพิธภัณฑ์
            </h2>
            <div class="museum-image-container">
              <img src="https://blog.wu.ac.th/wp-content/uploads/2022/10/S__12132359.jpg" alt="Museum Layout"
                class="museum-image">
              <!-- Room markers -->
              <!-- (คงเดิม) -->
            </div>

            <div class="legend">
              <div class="legend-item">
                <div class="legend-color capacity-green"></div>
                <span class="legend-text">ว่าง (&lt;60%)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color capacity-yellow"></div>
                <span class="legend-text">ค่อนข้างเต็ม (60-80%)</span>
              </div>
              <div class="legend-item">
                <div class="legend-color capacity-red"></div>
                <span class="legend-text">เต็มเกือบหมด (&gt;80%)</span>
              </div>
            </div>
          </div>

          <div class="details-panel">
            <div id="roomDetails" class="empty-state">
              <div class="empty-icon">
                <i class="bi bi-hand-index"></i>
              </div>
              <p style="font-size: 1.2rem; margin-bottom: 10px;">คลิกที่จุดบนแผนผัง</p>
              <p style="font-size: 1rem;">เพื่อดูรายละเอียดของแต่ละห้อง</p>
            </div>

            <div class="quick-stats">
              <h4 class="quick-stats-title">
                <i class="bi bi-trophy-fill"></i>
                ห้องที่คนเยอะที่สุด
              </h4>
              <div id="topRooms">
                <div class="quick-stat-item">
                  <span class="quick-stat-label">กำลังโหลด...</span>
                  <span class="quick-stat-value">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Section -->
        <div class="analytics-section">
          <h2 class="section-title">
            <i class="bi bi-bar-chart"></i>
            การวิเคราะห์และสถิติ
          </h2>

          <div class="analytics-grid">
            <!-- Demographics Chart -->
            <div class="chart-card">
              <h3 class="chart-title">
                <i class="bi bi-people"></i>
                กลุ่มผู้เยี่ยมชมตามเพศและอายุ
              </h3>
              <div class="chart-container">
                <canvas id="demographicsChart"></canvas>
              </div>
            </div>

            <!-- Room Popularity Chart -->
            <div class="chart-card">
              <h3 class="chart-title">
                <i class="bi bi-star-fill"></i>
                ความนิยมของแต่ละห้อง
              </h3>
              <div class="chart-container">
                <canvas id="roomPopularityChart"></canvas>
              </div>
            </div>

            <!-- Time Spent Chart -->
            <div class="chart-card full-width">
              <h3 class="chart-title">
                <i class="bi bi-clock-fill"></i>
                เวลาที่ใช้ในแต่ละห้อง (นาที)
              </h3>
              <div class="chart-container">
                <canvas id="timeSpentChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="../../assets/js/dashboard.js"></script>
  <script src="../../assets/js/chart.js"></script>
  <script src="../../assets/js/popularity_chart.js"></script>
  <script src="../../assets/js/time_spent_chart.js"></script>

</body>

</html>